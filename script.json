// ==UserScript==
// @name         Paywall to Archive (Universal)
// @namespace    http://tampermonkey.net/
// @version      2.0
// @description  åœ¨å„å¤§ä»˜è´¹æ–°é—»ç½‘ç«™æ·»åŠ æ‚¬æµ®æŒ‰é’®ï¼Œä¸€é”®è·³è½¬åˆ°Archive.todayé˜…è¯»å…¨æ–‡
// @author       
// @match        https://www.wsj.com/*
// @match        https://www.ft.com/*
// @match        https://www.nytimes.com/*
// @match        https://www.washingtonpost.com/*
// @match        https://www.economist.com/*
// @match        https://www.bloomberg.com/*
// @match        https://www.theatlantic.com/*
// @match        https://www.wired.com/*
// @match        https://www.newyorker.com/*
// @match        https://www.telegraph.co.uk/*
// @match        https://www.thetimes.co.uk/*
// @match        https://www.latimes.com/*
// @match        https://www.bostonglobe.com/*
// @match        https://www.chicagotribune.com/*
// @match        https://www.seattletimes.com/*
// @match        https://www.nature.com/*
// @match        https://www.scientificamerican.com/*
// @match        https://www.thelancet.com/*
// @match        https://www.cell.com/*
// @match        https://www.science.org/*
// @match        https://www.pnas.org/*
// @match        https://www.theinformation.com/*
// @match        https://www.vanityfair.com/*
// @match        https://www.barrons.com/*
// @match        https://www.forbes.com/*
// @match        https://www.inc.com/*
// @match        https://qz.com/*
// @match        https://www.independent.co.uk/*
// @match        https://www.smh.com.au/*
// @match        https://www.theaustralian.com.au/*
// @match        https://www.torontostar.com/*
// @match        https://nationalpost.com/*
// @match        https://www.nzherald.co.nz/*
// @match        https://www.japantimes.co.jp/*
// @match        https://www.thehindu.com/*
// @match        https://www.spectator.co.uk/*
// @match        https://www.newstatesman.com/*
// @grant        none
// ==/UserScript==

(function() {
    'use strict';

    // ç½‘ç«™é…ç½® - å¯ä»¥ä¸ºç‰¹å®šç½‘ç«™è‡ªå®šä¹‰æŒ‰é’®æ–‡æœ¬
    const siteConfig = {
        'wsj.com': { name: 'WSJ', color: '#222' },
        'ft.com': { name: 'FT', color: '#2e6e9e' },
        'nytimes.com': { name: 'NYT', color: '#000' },
        'washingtonpost.com': { name: 'WaPo', color: '#222' },
        'economist.com': { name: 'Economist', color: '#e3120b' },
        'bloomberg.com': { name: 'Bloomberg', color: '#000' },
        'default': { name: 'Article', color: '#222' }
    };

    // è·å–å½“å‰ç«™ç‚¹é…ç½®
    const hostname = window.location.hostname;
    let config = siteConfig.default;
    for (let domain in siteConfig) {
        if (hostname.includes(domain)) {
            config = siteConfig[domain];
            break;
        }
    }

    // åˆ›å»ºæ‚¬æµ®æŒ‰é’®
    const btn = document.createElement('button');
    btn.innerHTML = `ğŸ“– Read Free<br><small style="font-size:10px;opacity:0.8">(Archive)</small>`;

    // è®¾ç½®æŒ‰é’®æ ·å¼
    Object.assign(btn.style, {
        position: 'fixed',
        bottom: '20px',
        right: '20px',
        zIndex: '999999',
        padding: '12px 16px',
        backgroundColor: config.color,
        color: '#fff',
        border: 'none',
        borderRadius: '8px',
        cursor: 'pointer',
        boxShadow: '0 4px 12px rgba(0,0,0,0.3)',
        fontSize: '13px',
        fontFamily: 'system-ui, -apple-system, sans-serif',
        fontWeight: '600',
        lineHeight: '1.4',
        textAlign: 'center',
        transition: 'all 0.2s ease',
        opacity: '0.85'
    });

    // é¼ æ ‡æ‚¬åœæ•ˆæœ
    btn.onmouseover = function() {
        btn.style.opacity = '1';
        btn.style.transform = 'scale(1.05)';
        btn.style.boxShadow = '0 6px 16px rgba(0,0,0,0.4)';
    };
    btn.onmouseout = function() {
        btn.style.opacity = '0.85';
        btn.style.transform = 'scale(1)';
        btn.style.boxShadow = '0 4px 12px rgba(0,0,0,0.3)';
    };

    // ç‚¹å‡»äº‹ä»¶
    btn.onclick = function() {
        // æ¸…ç†URLå‚æ•°å’Œé”šç‚¹
        let url = window.location.href;
        url = url.split('?')[0];  // ç§»é™¤æŸ¥è¯¢å‚æ•°
        url = url.split('#')[0];  // ç§»é™¤é”šç‚¹

        // ç‰¹æ®Šå¤„ç†æŸäº›ç½‘ç«™çš„URL
        // ä¾‹å¦‚ NYT æœ‰æ—¶ä¼šæœ‰ /live/ è¿™ç§åŠ¨æ€URLï¼Œå¯èƒ½éœ€è¦ç‰¹æ®Šå¤„ç†
        // è¿™é‡Œæš‚æ—¶ä½¿ç”¨é€šç”¨é€»è¾‘

        // æ„å»ºArchiveé“¾æ¥
        const archiveUrl = 'https://archive.today/latest/' + url;

        // åœ¨æ–°æ ‡ç­¾é¡µæ‰“å¼€
        window.open(archiveUrl, '_blank');

        // å¯é€‰ï¼šæŒ‰é’®ç‚¹å‡»åé¦ˆ
        btn.innerHTML = 'âœ“ Opened!';
        setTimeout(() => {
            btn.innerHTML = `ğŸ“– Read Free<br><small style="font-size:10px;opacity:0.8">(Archive)</small>`;
        }, 1500);
    };

    // ç­‰å¾…é¡µé¢åŠ è½½å®Œæˆåæ·»åŠ æŒ‰é’®
    if (document.body) {
        document.body.appendChild(btn);
    } else {
        window.addEventListener('load', () => {
            document.body.appendChild(btn);
        });
    }

    // é”®ç›˜å¿«æ·é”® (å¯é€‰)ï¼šæŒ‰ Alt+A å¿«é€Ÿè·³è½¬
    document.addEventListener('keydown', function(e) {
        if (e.altKey && e.key === 'a') {
            e.preventDefault();
            btn.click();
        }
    });

})();